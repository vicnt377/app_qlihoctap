{{!< admin}}

<div class="dashboard-header mb-3">
  <h3 class="dashboard-title">Chi Tiết Video</h3>
</div>

<main class="container py-4">
  <a href="/admin/videos" class="btn btn-outline-primary btn-sm mb-3">
    <i class="fas fa-arrow-left me-1"></i> Quay lại
  </a>

  <div class="card shadow rounded-4 p-4">
    <div class="row g-4">

      <!-- LEFT: Video Info -->
      <div class="col-lg-8 col-md-7">
        <h2 class="fw-bold mb-3">{{video.title}}</h2>

        <div class="mb-3">
          <span class="badge bg-primary px-3 py-2">{{video.category}}</span>
          <span class="badge bg-info text-dark px-3 py-2 ms-2">{{video.duration}}</span>
        </div>

        <p class="text-muted">{{video.description}}</p>

        <div class="d-flex gap-4 text-muted small mb-3">
          <span><i class="fas fa-user-graduate me-1"></i>{{video.students}} học viên</span>
          <span><i class="fas fa-star text-warning me-1"></i>{{video.rating}}</span>
        </div>

        <hr class="my-4">

        <h5 class="mt-3 mb-3">
          <i class="fas fa-comments me-2"></i>Đánh giá của học viên
        </h5>
        {{#each video.reviews}}
          <div class="border rounded p-3 mb-3 bg-light shadow-sm">

            <!-- User info -->
            <div class="d-flex align-items-center mb-2">
              <img 
                src="{{this.user.avatar}}" 
                class="rounded-circle me-2" 
                width="42" 
                height="42">
              <strong>{{this.user.username}}</strong>
            </div>

            <!-- Rating -->
            <div class="text-warning mb-2 fs-6">
              {{#each (range this.rating)}}★{{/each}}
            </div>

            <small class="text-muted">{{formatDate this.createdAt}}</small>
            <p class="mt-2">{{this.comment}}</p>

            <!-- ====== REPLIES SECTION ====== -->
            {{#if this.replies.length}}
              <div class="ms-4 mt-3">
                {{#each this.replies}}
                  <div class="border-start ps-3 mb-3">
                    <strong class="text-primary">{{author}}</strong>
                    <small class="text-muted"> — {{formatDate createdAt}}</small>
                    <p class="mb-1">{{text}}</p>
                  </div>
                {{/each}}
              </div>
            {{/if}}

            <!-- ====== ADMIN REPLY FORM ====== -->
            <form action="/admin/videos/{{../video._id}}/reviews/{{this._id}}/reply" 
                  method="POST" 
                  class="ms-4 mt-2">

              <div class="input-group input-group-sm">
                <input type="text" 
                      name="reply" 
                      class="form-control" 
                      placeholder="Trả lời đánh giá này...">
                <button class="btn btn-primary">
                  <i class="fas fa-reply"></i>
                </button>
              </div>

            </form>

          </div>
        {{else}}
          <p class="text-muted fst-italic">Chưa có đánh giá nào.</p>
        {{/each}}

      </div>

      <!-- RIGHT: Video Player -->
      <div class="col-lg-4 col-md-5">
        <div class="border rounded shadow-sm p-2 bg-light">
          <iframe
            width="100%"
            height="260"
            src="https://www.youtube.com/embed/{{video.youtubeId}}"
            class="rounded-3"
            allowfullscreen>
          </iframe>
        </div>
      </div>

    </div>
  </div>
</main>
