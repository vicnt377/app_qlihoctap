{{!< admin}}
<title>Báo Cáo - Thống Kê</title>

<div class="dashboard-header flex items-center justify-between mb-6">
  <h3 class="dashboard-title mb-0 text-2xl">Báo Cáo - Thống Kê</h3>
    <a href="/admin/statistic/export-pdf"
       class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm">
        <i class="bi bi-file-earmark-arrow-down"></i>
        Xuất báo cáo
    </a>

</div>

<main class="container mx-auto">
  <div class="space-y-10 p-6 min-h-screen text-gray-800">

    {{#if error}}
      <div class="bg-red-100 text-red-700 px-4 py-3 rounded-lg border border-red-300">
        {{error}}
      </div>
    {{/if}}

    <!-- THỐNG KÊ TỔNG QUAN -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

      <div class="bg-white p-6 rounded-2xl shadow border hover:shadow-md transition flex justify-between items-center">
        <div>
          <p class="text-3xl font-bold">{{totalUsers}}</p>
          <p class="text-sm text-gray-500 mt-1">Tổng học viên</p>
        </div>
        <div class="p-3 bg-blue-100 rounded-xl">
          <i class="fas fa-users text-blue-600 text-xl"></i>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow border hover:shadow-md transition flex justify-between items-center">
        <div>
          <p class="text-3xl font-bold">{{totalVideos}}</p>
          <p class="text-sm text-gray-500 mt-1">Tổng video</p>
        </div>
        <div class="p-3 bg-green-100 rounded-xl">
          <i class="fas fa-video text-green-600 text-xl"></i>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow border hover:shadow-md transition flex justify-between items-center">
        <div>
          <p class="text-3xl font-bold">{{totalRegisters}}</p>
          <p class="text-sm text-gray-500 mt-1">Lượt đăng ký</p>
        </div>
        <div class="p-3 bg-purple-100 rounded-xl">
          <i class="fas fa-chart-line text-purple-600 text-xl"></i>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow border hover:shadow-md transition flex justify-between items-center">
        <div>
          <p class="text-3xl font-bold">{{completedVideos}}</p>
          <p class="text-sm text-gray-500 mt-1">Hoàn thành</p>
        </div>
        <div class="p-3 bg-amber-100 rounded-xl">
          <i class="fas fa-trophy text-amber-600 text-xl"></i>
        </div>
      </div>
    </section>

    <!-- BIỂU ĐỒ (NHỎ, GỌN, TRUNG TÂM) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

        <!-- LINE CHART -->
        <div class="bg-white p-6 rounded-2xl shadow border mb-6">
        <h2 class="text-lg font-semibold mb-4">Xu hướng đăng ký</h2>
        <div class="max-w-xl mx-auto">
            <canvas id="lineChart" height="120"></canvas>
        </div>
        </div>

        <!-- PIE CHART -->
        <div class="bg-white p-6 rounded-2xl shadow border mb-6">
        <h2 class="text-lg font-semibold mb-4">Tỷ lệ hoàn thành video</h2>
        <div class="max-w-xs mx-auto">
            <canvas id="pieChart" height="190"></canvas>
        </div>
        </div>

        <!-- BAR CHART -->
        <div class="bg-white p-6 rounded-2xl shadow border mb-6 lg:col-span-2">
        <h2 class="text-lg font-semibold mb-4">Thống kê theo chuyên ngành</h2>
        <div class="max-w-3xl mx-auto">
            <canvas id="barChart" height="150"></canvas>
        </div>
        </div>
    </div>
  </div>
</main>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const growthLabels = {{json growthLabels}};
const growthValues = {{json growthValues}};

// Line chart
new Chart(document.getElementById('lineChart'), {
  type: 'line',
  data: {
    labels: growthLabels,
    datasets: [{
      label: "Lượt đăng ký",
      data: growthValues,
      borderWidth: 2,
      borderColor: '#2563eb',
      fill: false,
      tension: 0.3
    }]
  }
});

// Pie chart
new Chart(document.getElementById('pieChart'), {
  type: 'pie',
  data: {
    labels: ['Hoàn thành', 'Chưa hoàn thành'],
    datasets: [{
      data: [
        {{completedVideos}},
        {{totalVideos}} - {{completedVideos}}
      ],
    }]
  }
});

// Bar chart chuyên ngành
const majorLabels = {{json majorLabels}};
const majorValues = {{json majorValues}};

new Chart(document.getElementById('barChart'), {
  type: 'bar',
  data: {
    labels: majorLabels,
    datasets: [{
      label: 'Số học viên',
      data: majorValues,
      borderWidth: 1
    }]
  }
});
</script>

