
<!-- Header Section with Gradient Background (reuse document header styles) -->
<div class="document-header mb-3">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-8">
         <h1 class="h2 fw-bold text-white mb-2">
           <i class="fas fa-home me-2"></i>Trang Ch·ªß
         </h1>
         <div class="welcome-section">
           <div class="welcome-text mb-2">
             <span class="text-white fs-5">üëã Ch√†o m·ª´ng tr·ªü l·∫°i, </span>
             <span class="text-white fw-bold fs-5">{{user.username}}</span>
             <span class="text-white fs-5">!</span>
           </div>
           <p class="text-white-50 mb-0 fs-6">Ch√∫c b·∫°n c√≥ m·ªôt ng√†y h·ªçc hi·ªáu qu·∫£</p>
         </div>
      </div>
      <div class="col-md-4">
        <div class="row g-2">
          <div class="col-4">
            <div class="stats-card p-2 text-center">
              <div class="stats-item">
                <i class="fas fa-award text-orange mb-1"></i>
                <div class="stats-number small">{{totalCredits}}</div>
                <div class="stats-label small">T√≠n ch·ªâ</div>
              </div>
            </div>
          </div>
          <div class="col-4">
            <div class="stats-card p-2 text-center">
              <div class="stats-item">
                <i class="fas fa-video text-orange mb-1"></i>
                <div class="stats-number small">
                  {{#if enrolledVideos.length}}{{enrolledVideos.length}}{{else}}0{{/if}}
                </div>
                <div class="stats-label small">Kh√≥a h·ªçc</div>
              </div>
            </div>
          </div>
          <div class="col-4">
            <div class="stats-card p-2 text-center">
              <div class="stats-item">
                <i class="fas fa-file-alt text-orange mb-1"></i>
                <div class="stats-number small">{{recentDocsCount}}</div>
                <div class="stats-label small">T√†i li·ªáu m·ªõi</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<main class="container-fluid px-4">
  <!-- H√†ng th·∫ª truy c·∫≠p nhanh (tr√°i) + t√†i li·ªáu m·ªõi (tr√°i) v√† bi·ªÉu ƒë·ªì (ph·∫£i) -->
  <div class="row g-3 mb-3">
    <!-- C·ªôt tr√°i -->
    <div class="col-lg-5 d-flex flex-column gap-3">
      
      <!-- Truy c·∫≠p nhanh -->
      <div class="card shadow-sm border-0">
        <div class="card-header bg-gradient-gray text-white py-2">
          <h6 class="mb-0"><i class="fas fa-bolt me-2"></i>Truy c·∫≠p nhanh</h6>
        </div>
        <div class="card-body pt-3 pb-2">
          <div class="row row-cols-2 row-cols-md-3 g-2 text-center">
            <a href="/course" class="col text-decoration-none text-dark">
              <div class="p-3 border rounded shadow-sm bg-light hover-shadow">
                <i class="fas fa-book fa-lg text-primary mb-2"></i>
                <div class="small">H·ªçc Ph·∫ßn</div>
              </div>
            </a>
            <a href="/document" class="col text-decoration-none text-dark">
              <div class="p-3 border rounded shadow-sm bg-light hover-shadow">
                <i class="fas fa-file fa-lg text-success mb-2"></i>
                <div class="small">T√†i Li·ªáu</div>
              </div>
            </a>
            <a href="/progress" class="col text-decoration-none text-dark">
              <div class="p-3 border rounded shadow-sm bg-light hover-shadow">
                <i class="fas fa-chart-line fa-lg text-warning mb-2"></i>
                <div class="small">Ti·∫øn ƒê·ªô</div>
              </div>
            </a>
            <a href="/semester" class="col text-decoration-none text-dark">
              <div class="p-3 border rounded shadow-sm bg-light hover-shadow">
                <i class="fas fa-calendar-alt fa-lg text-danger mb-2"></i>
                <div class="small">L·ªãch H·ªçc</div>
              </div>
            </a>
            <a href="/score" class="col text-decoration-none text-dark">
              <div class="p-3 border rounded shadow-sm bg-light hover-shadow">
                <i class="fas fa-graduation-cap fa-lg text-secondary mb-2"></i>
                <div class="small">K·∫øt Qu·∫£</div>
              </div>
            </a>
            <a href="/video" class="col text-decoration-none text-dark">
              <div class="p-3 border rounded shadow-sm bg-light hover-shadow">
                <i class="fas fa-video fa-lg" style="color: #cf4408;"></i>
                <div class="small">Kh√≥a H·ªçc</div>
              </div>
            </a>
          </div>
        </div>
      </div>

      <!-- C√°c t√†i li·ªáu m·ªõi -->
      <div class="card shadow-sm border-0">
        <div class="card-header bg-gradient-gray text-white py-2">
          <h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>C√°c t√†i li·ªáu m·ªõi</h6>
        </div>
        <div class="card-body p-0">
          {{#if recentDocs.length}}
            <div style="max-height: 250px; overflow-y: auto;">   <!-- ‚úÖ cu·ªôn d·ªçc -->
              <ul class="list-group list-group-flush">
                {{#each recentDocs}}
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                      <i class="{{getFileIcon this}} me-2"></i>
                      <strong>{{this.title}}</strong>
                      <small class="text-muted"> - {{this.user.username}}</small>
                      <div class="small text-muted">
                        {{formatDate this.createdAt}} ‚Ä¢ {{formatFileSize this.fileSize}}
                      </div>
                    </div>
                    <div>
                      <a href="/document/preview/{{this._id}}" 
                        class="btn btn-sm btn-outline-orange" target="_blank">
                        Xem
                      </a>
                    </div>
                  </li>
                {{/each}}
              </ul>
            </div>
          {{else}}
            <div class="text-center py-4">
              <div class="empty-state">
                <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                <h6 class="text-muted mb-2">Kh√¥ng c√≥ t√†i li·ªáu m·ªõi n√†o</h6>
                <p class="text-muted mb-3 small">C√°c t√†i li·ªáu public m·ªõi s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y</p>
                <a href="/document" class="btn btn-outline-orange btn-sm">
                  <i class="fas fa-folder-open me-1"></i>Xem t√†i li·ªáu
                </a>
              </div>
            </div>
          {{/if}}
        </div>
      </div>

    </div>

    <!-- C·ªôt ph·∫£i -->
    <div class="col-lg-7">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-gradient-gray text-white py-2">
          <h6 class="mb-0"><i class="fas fa-chart-column me-2"></i>Th·ªëng k√™ h·ªçc t·∫≠p</h6>
        </div>
        <div class="card-body p-4">
          <p class="mb-3"><strong>{{totalCredits}} / 152 t√≠n ch·ªâ ƒë√£ ho√†n th√†nh</strong></p>
          <canvas id="creditChart" height="180"></canvas>
          {{#if totalCreditsExceeded}}
            <div class="alert alert-warning mt-3 mb-0" role="alert">
              <i class="fas fa-exclamation-triangle me-2"></i>S·ªë t√≠n ch·ªâ v∆∞·ª£t qu√° gi·ªõi h·∫°n!
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>

  <!-- C√°c kh√≥a h·ªçc ƒë√£ tham gia (nh·ªè l·∫°i) -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-gradient-gray text-white py-2">
      <h6 class="mb-0"><i class="fas fa-list me-2"></i>C√°c kh√≥a h·ªçc ƒë√£ tham gia</h6>
    </div>
    <div class="card-body p-3">
      {{#if enrolledVideos.length}}
        <div class="row g-2">
          {{#each enrolledVideos}}
            <div class="col-md-3 col-sm-6">
              <div class="card h-100 shadow-sm border-0">
                <img src="https://img.youtube.com/vi/{{this.youtubeId}}/hqdefault.jpg" class="card-img-top" alt="{{this.title}}" />
                <div class="card-body d-flex flex-column p-2">
                  <h6 class="card-title small mb-1 text-truncate">{{this.title}}</h6>
                  <a href="/video/start/{{this._id}}" class="btn btn-sm btn-orange mt-auto">
                    <i class="fas fa-play me-1"></i>H·ªçc
                  </a>
                </div>
              </div>
            </div>
          {{/each}}
        </div>
      {{else}}
        <div class="text-center py-4">
          <div class="empty-state">
            <i class="fas fa-video fa-3x text-muted mb-3"></i>
            <h6 class="text-muted mb-2">B·∫°n ch∆∞a tham gia kh√≥a h·ªçc n√†o</h6>
            <p class="text-muted mb-3 small">Kh√°m ph√° v√† ƒëƒÉng k√Ω kh√≥a h·ªçc ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
            <a href="/video" class="btn btn-outline-orange btn-sm">
              <i class="fas fa-compass me-1"></i>Kh√°m ph√° kh√≥a h·ªçc
            </a>
          </div>
        </div>
      {{/if}}
    </div>
  </div>

  {{!-- Modal ch√∫c m·ª´ng --}}
  {{#if showCongrats}}
  <div class="modal fade" id="congratsModal" tabindex="-1" aria-labelledby="congratsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4 shadow-lg border-0 overflow-hidden">
        
        <!-- Header v·ªõi n·ªÅn gradient -->
        <div class="modal-header border-0 text-success">
          <h5 style="color: #198754" class="modal-title fw-bold d-flex align-items-center" id="congratsModalLabel">
            üéâ Ch√†o {{user.username}}!
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
        </div>
        
        <!-- N·ªôi dung -->
        <div class="modal-body text-center p-4">
          <h4 class="fw-bold text-success mb-3">ƒêƒÉng k√Ω th√†nh c√¥ng!</h4>
          <p class="text-muted mb-4">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi <span class="fw-bold text-dark">H·ªá th·ªëng h·ªó tr·ª£ qu·∫£n l√Ω h·ªçc t·∫≠p</span>.</p>
          <img src="/img/congrat.png" alt="Congrats" class="img-fluid mb-4" style="max-height:200px;">
        </div>
        
        {{!-- <!-- Footer v·ªõi n√∫t ƒë√≥ng -->
        <div class="modal-footer border-0 justify-content-center pb-4">
          <button type="button" class="btn btn-success px-4 rounded-pill shadow-sm" data-bs-dismiss="modal">
            <i class="fas fa-check-circle me-2"></i>B·∫Øt ƒë·∫ßu ngay
          </button>
        </div> --}}
      </div>
    </div>
  </div>
  {{/if}}

</main>
{{!-- Modal congrats --}}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modalEl = document.getElementById('congratsModal');
    if (modalEl) {
      const modal = new bootstrap.Modal(modalEl, {
        backdrop: 'static',
        keyboard: false
      });

      let running = true;

      // H√†m b·∫Øn confetti li√™n t·ª•c
      function fireConfetti() {
        if (!running) return;
        confetti({
          particleCount: 5,
          startVelocity: 25,
          spread: 360,
          origin: { x: Math.random(), y: Math.random() - 0.2 }
        });
        requestAnimationFrame(fireConfetti);
      }

      // Khi modal hi·ªÉn th·ªã
      modal.show();
      fireConfetti();

      // Khi modal ƒë√≥ng => d·ª´ng confetti
      modalEl.addEventListener('hidden.bs.modal', () => {
        running = false;
      });
    }
  });
</script>


<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const totalCredits = {{totalCredits}};
  const remainingCredits = 152 - totalCredits;
  const totalNoSubjects = {{totalNoSubjects}};

  const ctx = document.getElementById('creditChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['ƒê√£ ho√†n th√†nh', 'C√≤n l·∫°i', 'M√¥n b·ªã n·ª£'],
      datasets: [{
        label: 'Th·ªëng k√™ h·ªçc t·∫≠p',
        data: [totalCredits, remainingCredits, totalNoSubjects],
        backgroundColor: ['#ff8c42', '#cfd8dc', '#ef9a9a'],
        borderColor: ['#ff6f00', '#b0bec5', '#e57373'],
        borderWidth: 1,
        borderRadius: 6
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true, max: 152, title: { display: true, text: 'S·ªë l∆∞·ª£ng' } }
      },
      plugins: { legend: { display: false } }
    }
  });
</>
