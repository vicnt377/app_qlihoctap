<!-- C√°c script kh√°c (jQuery, select2...) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Th√™m Bootstrap JS ƒë·ªÉ Modal ho·∫°t ƒë·ªông -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />


<div class="dashboard-header">
  <h2 class="dashboard-title mb-0"><i class="fas fa-calendar-alt"></i> L·ªãch H·ªçc</h2>

  <div class="user-info position-relative">
    <img src="{{user.avatar}}" alt="Avatar" class="user-avatar dropdown-toggle"
         onerror="this.onerror=null;this.src='/img/avatar.png';"
         id="avatarDropdown" />

    <span class="user-name">{{user.username}}</span>

    <!-- Menu dropdown -->
    <div class="dropdown-menu-user" id="userMenu">
      <a href="/account" class="dropdown-item"><i class="fas fa-pen"></i> Ch·ªânh s·ª≠a th√¥ng tin</a>
      <a href="/logout" class="dropdown-item"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</a>
    </div>
  </div>
</div>

<main class="col-md-9 col-lg-10 content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSemesterModal">
            ‚ûï Th√™m h·ªçc k·ª≥ m·ªõi
        </button>
    </div>

    <!-- Modal th√™m h·ªçc k·ª≥ -->
    <div class="modal fade" id="addSemesterModal" tabindex="-1" aria-labelledby="addSemesterModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form id="addSemesterForm" method="POST" action="/semester/add" class="modal-content">
            <div class="modal-header">
                <h5 style="color: black;" class="modal-title" id="addSemesterModalLabel">‚ûï Th√™m h·ªçc k·ª≥ m·ªõi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                <label style="color: black;" for="tenHocKy" class="form-label" >T√™n h·ªçc k·ª≥</label>
                <select name="tenHocKy" class="form-control">

                    <option value="" disabled selected>-- Ch·ªçn H·ªçc K·ª≥ --</option>
                    <option value="H·ªçc K·ª≥ 1">H·ªçc K·ª≥ 1</option>
                    <option value="H·ªçc K·ª≥ 2">H·ªçc K·ª≥ 2</option>
                    <option value="H·ªçc K·ª≥ 3">H·ªçc K·ª≥ 3</option>
                </select>
                </div>
                <div class="mb-3">
                <label style="color: black;" for="namHoc" class="form-label">NƒÉm h·ªçc</label>
                <input type="text" class="form-control" name="namHoc" placeholder="VD: 2012 - 2022" required>
                </div>
                
                <hr>
                <h6 style="color: black;">‚ûï Ch·ªçn l·ªãch h·ªçc (Score)</h6>

                <div class="mb-3">
                    <label style="color: black;" for="selectedScores" class="form-label">L·ªãch h·ªçc</label>
                    <select name="selectedScores[]" multiple class="form-control" style="height: 150px;">
                        {{#each scores}}
                        <option value="{{this._id}}">
                            {{this.thu}} - {{this.HocPhan.tenHocPhan}} ({{this.gioHoc}})
                        </option>
                        {{/each}}
                    </select>
                    <small class="text-muted">Gi·ªØ Ctrl ƒë·ªÉ ch·ªçn nhi·ªÅu d√≤ng</small>
                </div>

            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-success">L∆∞u</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
            </div>
            </form>
            <div id="alertBox" class="mt-3"></div>
        </div>
    </div>

    <!-- B·ªô l·ªçc h·ªçc k·ª≥ + nƒÉm h·ªçc -->
    <form method="GET" action="/semester" class="row g-4 mb-4">
        <div class="col-md-4">
            <select name="year" class="form-select" required>
                <option value="T·∫•t c·∫£" {{#if (eq selectedYear 'T·∫•t c·∫£')}}selected{{/if}}>T·∫•t c·∫£</option>
                {{#each years}}
                <option value="{{this}}" {{#ifEquals ../selectedYear this}}selected{{/ifEquals}}>{{this}}</option>
                {{/each}}
                
            </select>
        </div>
        <div class="col-md-4">
            <select name="semester" class="form-select" required>
                <option value="T·∫•t c·∫£" {{#if (eq selectedSemester 'T·∫•t c·∫£')}}selected{{/if}}>T·∫•t c·∫£</option>
                {{#each semestersList}}
                <option value="{{this}}" {{#ifEquals ../selectedSemester this}}selected{{/ifEquals}}>{{this}}</option>
                {{/each}}
                
            </select>
        </div>
        <div class="col-md-4">
            <button class="btn btn-success"> üîç </button>
        </div>

    </form>

    <!-- Danh s√°ch l·ªãch h·ªçc -->

    <div class="card p-4">
        {{#if classesGroupedBySemester.length}}
            {{#each classesGroupedBySemester}}
                <h5 class=" text-primary">{{tenHocKy}} - {{namHoc}}</h5>
                <ul class="list-group mb-3">
                    {{#each scores}}
                    <li class="list-group-item">
                        üìå {{thu}} - {{HocPhan.tenHocPhan}}  ({{gioHoc}})
                    </li>
                    {{/each}}
                </ul>
            {{/each}}
        {{else}}
            <li class="list-group-item text-muted">Kh√¥ng c√≥ l·ªãch h·ªçc cho h·ªçc k·ª≥ n√†y.</li>
        {{/if}}

    </div>
</main>