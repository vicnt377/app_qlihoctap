<div class="document-header mb-3">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="h3 fw-bold text-white mb-1">
         Các Video Tham Khảo
        </h1>
        <p class="text-white-50 mb-0">Khám phá và đăng ký các video trực tuyến</p>
      </div>
      {{!-- <div class="col-md-4 text-end">
        <div class="stats-card">
          <div class="stats-item">
            <i class="fas fa-file-pdf text-orange"></i>
            <span class="stats-number">{{enrolledCount}}</span>
            <span class="stats-label">Video</span>
          </div>
        </div>
      </div> --}}
    </div>
  </div>
</div>

<main class="container mt-4">

  {{!-- VIDEO ĐÃ THAM GIA --}}
  <h4 class="fw-bold mb-3 text-primary">
     Video đã quan tâm ({{enrolledCount}})
  </h4>

  <div class="video-list container-fluid mb-5">
    <div class="row g-4">
      {{#if enrolledVideos.length}}
        {{#each enrolledVideos}}
          <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
            <div class="card video-card h-100 shadow-sm rounded-3 overflow-hidden">

              <img src="https://img.youtube.com/vi/{{youtubeId}}/hqdefault.jpg"
                   class="card-img-top" style="height: 180px; object-fit: cover;">

              <div class="card-body d-flex flex-column">
                <h6 class="fw-bold text-truncate">{{title}}</h6>
                <p class="text-muted small text-truncate-2">{{description}}</p>

                {{#if (gt currentTime 5)}}
                  <a href="/video/start/{{_id}}" class="btn btn-success btn-sm mt-auto w-100">
                     Tiếp tục xem
                  </a>
                {{else}}
                  <a href="/video/showdetail/{{_id}}" class="btn btn-primary btn-sm mt-auto w-100">
                    Xem chi tiết
                  </a>
                {{/if}}

              </div>
            </div>
          </div>
        {{/each}}
      {{else}}
        <p class="text-muted">Bạn chưa quan tâm video nào.</p>
      {{/if}}
    </div>
  </div>

  {{!-- VIDEO KHÁC --}}
  <h4 class="fw-bold mb-3 text-secondary">
     Video dành cho bạn ({{otherCount}})
  </h4>

  <div class="video-list container-fluid mb-5">
    <div class="row g-4">
      {{#each notEnrolledVideos}}
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12">
          <div class="card video-card h-100 shadow-sm rounded-3 overflow-hidden">

            <img src="https://img.youtube.com/vi/{{youtubeId}}/hqdefault.jpg"
                 class="card-img-top" style="height: 180px; object-fit: cover;">

            <div class="card-body d-flex flex-column">
              <h6 class="fw-bold text-truncate">{{title}}</h6>
              <p class="text-muted small text-truncate-2">{{description}}</p>

              <a href="/video/showdetail/{{_id}}" class="btn btn-primary btn-sm mt-auto w-100">
                Xem chi tiết
              </a>
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  </div>

</main>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterForm = document.getElementById('filterForm');
  const searchInput = filterForm.querySelector('input[name="search"]');
  const categorySelect = filterForm.querySelector('select[name="category"]');
  const levelSelect = filterForm.querySelector('select[name="level"]');
  
  // Tự động submit form khi thay đổi select
  categorySelect.addEventListener('change', function() {
    filterForm.submit();
  });
  
  levelSelect.addEventListener('change', function() {
    filterForm.submit();
  });
  
  // Debounce search input để tránh gửi quá nhiều request
  let searchTimeout;
  searchInput.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      filterForm.submit();
    }, 500); // Đợi 500ms sau khi người dùng ngừng gõ
  });
  
  // Hiển thị loading khi submit form
  filterForm.addEventListener('submit', function() {
    const submitBtn = filterForm.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Đang lọc...';
    submitBtn.disabled = true;
    
    // Reset button sau 3 giây nếu có lỗi
    setTimeout(() => {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }, 3000);
  });
});
</script>
