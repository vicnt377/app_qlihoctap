{{!-- {{#if successMessage}}
<div class="alert alert-success alert-dismissible fade show" role="alert">
    {{successMessage}}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{{/if}}

{{#if errorMessage}}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
    {{errorMessage}}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{{/if}} --}}

<!-- Header Section with Gradient Background -->
<div class="document-header mb-3">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="h2 fw-bold text-white mb-1">
       Tài Khoản
        </h1>
        <p class="text-white-50 mb-0">Quản lý thông tin cá nhân và bảo mật tài khoản</p>
      </div>
    </div>
  </div>
</div>

<main class="container-fluid px-4">
  <div class="row g-4">
    <!-- Profile Card -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-gradient-gray text-white py-3">
          <h6 class="mb-0"></i>Thông tin cá nhân</h6>
        </div>
        <div class="card-body text-center p-4">
          <img src="{{user.avatar}}" alt="Avatar" class="rounded-circle mb-3 shadow-sm" 
               style="width: 120px; height: 120px; object-fit: cover;"
               onerror="this.onerror=null;this.src='/img/avatar.png';"/>

          <!-- Nút chỉnh sửa avatar -->
          <form action="/account/update-profile" method="POST" enctype="multipart/form-data" class="mb-3">
            <input type="file" name="avatar" accept="image/*" id="avatarInput" style="display: none;" onchange="this.form.submit()">
            <button type="button" class="btn btn-outline-orange btn-sm" onclick="document.getElementById('avatarInput').click()">
              Thay đổi ảnh đại diện
            </button>
          </form>

          <div class="profile-info">
            <h5 class="fw-bold mb-2">{{user.username}}</h5>
            <p class="text-muted mb-1">{{majorName user.major}}</p>
            <p class="text-muted mb-1">{{user.email}}</p>
            <p class="text-muted mb-3">{{user.phone}}</p>
          </div>

          <div class="mt-3">
            <a href="/logout" class="btn btn-outline-danger btn-sm">
             Đăng Xuất
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Profile Tabs -->
    <div class="col-lg-8">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-gradient-gray text-white py-3">
          <h6 class="mb-0">Chỉnh sửa thông tin</h6>
        </div>
        <div class="card-body p-4">
          <ul class="nav nav-pills mb-4" id="accountTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="profile-tab" data-bs-toggle="pill" data-bs-target="#profile" type="button" role="tab">
               Thông tin
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="study-tab" data-bs-toggle="pill" data-bs-target="#study" type="button" role="tab">
                Học tập
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="security-tab" data-bs-toggle="pill" data-bs-target="#security" type="button" role="tab">
                Bảo mật
              </button>
            </li>
          </ul>

          <div class="tab-content" id="accountTabsContent">
            <!-- Tab 1: Chỉnh sửa thông tin cá nhân -->
            <div class="tab-pane fade show active" id="profile" role="tabpanel">
              <form action="/account/update-profile" method="POST">
                <div class="mb-3">
                  <label for="username" class="form-label fw-bold">
                   Tên người dùng
                  </label>
                  <input type="text" class="form-control" id="username" name="username" value="{{user.username}}">
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label fw-bold">
                    Email
                  </label>
                  <input type="email" class="form-control" id="email" name="email" value="{{user.email}}">
                </div>
                <div class="mb-3">
                  <label for="phone" class="form-label fw-bold">
                    Số điện thoại
                  </label>
                  <input type="text" class="form-control" id="phone" name="phone" value="{{user.phone}}">
                </div>
                <div class="form-button">
                  <button type="submit" class="btn btn-orange">
                    Lưu thay đổi
                  </button>
                </div>
              </form>
            </div>

            <!-- Tab 2: Cập nhật mật khẩu -->
            <div class="tab-pane fade" id="security" role="tabpanel">
              <form action="/account/update-password" method="POST">
                <div class="mb-3">
                  <label for="currentPassword" class="form-label fw-bold">
                    Mật khẩu hiện tại
                  </label>
                  <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                </div>

                <div class="mb-3">
                  <label for="newPassword" class="form-label fw-bold">
                    Mật khẩu mới
                  </label>
                  <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                </div>

                <div class="mb-3">
                  <label for="confirmPassword" class="form-label fw-bold">
                    Xác nhận mật khẩu mới
                  </label>
                  <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                </div>

                <div class="form-button d-flex gap-2">
                  <button type="reset" class="btn btn-outline-secondary">
                   Đặt lại
                  </button>
                  <button type="submit" class="btn btn-orange">
                    Cập nhật mật khẩu
                  </button>
                </div>
              </form>
            </div>

            {{!-- Tab 3: cập nhật ngành học --}}
            <div class="tab-pane fade" id="study" role="tabpanel">
              <form action="/account/update-profile" method="POST">
                <div class="mb-3">
                  <label for="major" class="form-label fw-bold">
                   Ngành học
                  </label>
                  <select class="form-select" id="major" name="major" required>
                    <option value="">-- Lĩnh vực --</option>
                    <option value="CNTT" {{#if (eq user.major "CNTT")}}selected{{/if}}>Công nghệ thông tin</option>
                    <option value="YT" {{#if (eq user.major "YT")}}selected{{/if}}>Y tế</option>
                    <option value="GD" {{#if (eq user.major "GD")}}selected{{/if}}>Giáo dục</option>
                    <option value="NN" {{#if (eq user.major "NN")}}selected{{/if}}>Ngoại ngữ</option>
                    <option value="KT-TC" {{#if (eq user.major "KT-TC")}}selected{{/if}}>Kinh tế - Tài chính</option>
                    <option value="TN-MT" {{#if (eq user.major "TN-MT")}}selected{{/if}}>Tài nguyên - Môi trường</option>
                    <option value="KD-QL" {{#if (eq user.major "KD-QL")}}selected{{/if}}>Kinh doanh - Quản lý</option>
                    <option value="KT-XD" {{#if (eq user.major "KT-XD")}}selected{{/if}}>Kỹ thuật - Xây dựng</option>
                    <option value="L-NV" {{#if (eq user.major "L-NV")}}selected{{/if}}>Luật - Nhân văn</option>
                    <option value="ST-NT" {{#if (eq user.major "ST-NT")}}selected{{/if}}>Sáng tạo - Nghệ thuật</option>
                    <option value="DV-DL" {{#if (eq user.major "DV-DL")}}selected{{/if}}>Dịch vụ - Du lịch</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="totalCredits" class="form-label fw-bold">
                    Tổng số tín chỉ chương trình
                  </label>
                  <input type="number" class="form-control" id="totalCredits" name="totalCredits" value="{{user.totalCredits}}" min="0" required>
                </div>

                <div class="form-button">
                  <button type="submit" class="btn btn-orange">
                    Lưu thay đổi
                  </button>
                </div>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</main>